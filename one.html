<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pattaasu Kadai</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
        }
        .view-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .view-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Price increase is green with up arrow */
        .price-increased {
            color: #22c55e; /* green-500 */
        }
        /* Price decrease is red with down arrow */
        .price-decreased {
            color: #ef4444; /* red-500 */
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Hide scrollbar for number input */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        .editable-price-input {
            width: 80px;
            padding: 4px;
            border: 1px solid #3b82f6;
            border-radius: 4px;
            text-align: center;
        }
         #image-preview {
            margin-top: 1rem;
            max-width: 100px;
            max-height: 100px;
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 0.375rem;
            border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <svg class="h-8 w-8 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048l5.962-5.962a.75.75 0 011.06 1.06l-5.962 5.962A6.75 6.75 0 0012 19.5a6.75 6.75 0 005.362-10.952l-5.962 5.962a.75.75 0 01-1.06-1.06l5.962-5.962z" />
                    </svg>
                    <h1 class="text-xl font-bold text-gray-800">Pattaasu Kadai</h1>
                </div>
                <nav class="flex items-center space-x-2 sm:space-x-4">
                    <button id="nav-enquiry" class="nav-link active font-semibold text-red-600 border-b-2 border-red-600 px-3 py-2">Enquiry</button>
                    <button id="nav-admin" class="nav-link text-gray-500 hover:text-red-600 font-semibold px-3 py-2">Admin</button>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <section id="enquiry-view" class="view-section active">
             <div id="enquiry-header" class="text-center mb-8">
                <div class="flex items-center justify-center space-x-4">
                     <svg class="h-12 w-12 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048l5.962-5.962a.75.75 0 011.06 1.06l-5.962 5.962A6.75 6.75 0 0012 19.5a6.75 6.75 0 005.362-10.952l-5.962 5.962a.75.75 0 01-1.06-1.06l5.962-5.962z" />
                    </svg>
                    <h1 class="text-4xl font-bold text-gray-800">Pattaasu Kadai</h1>
                </div>
                 <p class="text-gray-600 mt-2">Price List</p>
            </div>
            
            <div id="product-list" class="space-y-6">
                </div>
        </section>

        <section id="admin-view" class="view-section">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Admin Panel - Manage Products</h2>
                <button id="add-product-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 transition-colors">Add New Product</button>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="p-3 font-semibold text-sm">ID</th>
                            <th class="p-3 font-semibold text-sm">Image</th>
                            <th class="p-3 font-semibold text-sm">English Name</th>
                            <th class="p-3 font-semibold text-sm">Tamil Name</th>
                            <th class="p-3 font-semibold text-sm">Original Price</th>
                            <th class="p-3 font-semibold text-sm">Offer Price</th>
                            <th class="p-3 font-semibold text-sm">Category</th>
                            <th class="p-3 font-semibold text-sm">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="admin-table-body">
                        </tbody>
                </table>
            </div>
        </section>
    </main>

    <div id="product-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 id="modal-title" class="text-xl font-bold mb-4">Add New Product</h3>
            <form id="product-form">
                <input type="hidden" id="product-id">
                <div class="space-y-4">
                    <input type="text" id="product-name" placeholder="English Name" class="w-full p-2 border rounded-md" required>
                    <input type="text" id="product-tamil-name" placeholder="Tamil Name" class="w-full p-2 border rounded-md" required>
                    
                    <div>
                        <label for="product-image-upload" class="block text-sm font-medium text-gray-700 mb-1">Product Image</label>
                        <input type="file" id="product-image-upload" class="w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-red-50 file:text-red-700
                            hover:file:bg-red-100" accept="image/*" required>
                        <img id="image-preview" src="" alt="Image Preview" class="hidden">
                    </div>

                    <input type="number" id="product-original-price" placeholder="Original Price (₹)" class="w-full p-2 border rounded-md" required>
                    <input type="number" id="product-offer-price" placeholder="Offer Price (₹)" class="w-full p-2 border rounded-md" required>
                    <input type="text" id="product-category" placeholder="Category" class="w-full p-2 border rounded-md" required>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" id="cancel-btn" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-400">Cancel</button>
                    <button type="submit" id="save-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600">Save Product</button>
                </div>
            </form>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- DATA ---
        const initialProducts = [
            { id: 1, name: '100 Wala Garland', tamilName: '100 வாலா சரம்', originalPrice: 150, offerPrice: 135, category: 'Garlands (சரங்கள்)', image: 'https://placehold.co/100x100/ef4444/ffffff?text=Garland', priceHistory: [135] },
            { id: 2, name: '28 Wala Giant Crackers', tamilName: '28 வாலா ஜெயின்ட்', originalPrice: 200, offerPrice: 180, category: 'Garlands (சரங்கள்)', image: 'https://placehold.co/100x100/ef4444/ffffff?text=Garland', priceHistory: [180] },
            { id: 3, name: '5000 Wala Garland', tamilName: '5000 வாலா சரம்', originalPrice: 2500, offerPrice: 2250, category: 'Garlands (சரங்கள்)', image: 'https://placehold.co/100x100/ef4444/ffffff?text=Garland', priceHistory: [2250] },
            { id: 4, name: 'Red Sparklers', tamilName: 'சிகப்பு மத்தாப்பு', originalPrice: 60, offerPrice: 50, category: 'Sparklers (மத்தாப்பு)', image: 'https://placehold.co/100x100/facc15/333333?text=Sparkler', priceHistory: [50] },
            { id: 5, name: 'Green Sparklers', tamilName: 'பச்சை மத்தாப்பு', originalPrice: 60, offerPrice: 50, category: 'Sparklers (மத்தாப்பு)', image: 'https://placehold.co/100x100/facc15/333333?text=Sparkler', priceHistory: [50] },
            { id: 6, name: 'Flower Pots (Small)', tamilName: 'பூந்தொட்டி (சிறியது)', originalPrice: 80, offerPrice: 70, category: 'Flower Pots (பூந்தொட்டி)', image: 'https://placehold.co/100x100/22c55e/ffffff?text=Pot', priceHistory: [70] },
            { id: 7, name: 'Flower Pots (Big)', tamilName: 'பூந்தொட்டி (பெரியது)', originalPrice: 120, offerPrice: 105, category: 'Flower Pots (பூந்தொட்டி)', image: 'https://placehold.co/100x100/22c55e/ffffff?text=Pot', priceHistory: [105] },
            { id: 8, name: 'Ground Chakkar (Small)', tamilName: 'சங்கு சக்கரம் (சிறியது)', originalPrice: 75, offerPrice: 65, category: 'Chakkars (சக்கரம்)', image: 'https://placehold.co/100x100/3b82f6/ffffff?text=Chakkar', priceHistory: [65] },
            { id: 9, name: 'Ground Chakkar (Big)', tamilName: 'சங்கு சக்கரம் (பெரியது)', originalPrice: 110, offerPrice: 95, category: 'Chakkars (சக்கரம்)', image: 'https://placehold.co/100x100/3b82f6/ffffff?text=Chakkar', priceHistory: [95] },
            { id: 10, name: '7 Shot Sky Fire', tamilName: '7 ஷாட் வானவேடிக்கை', originalPrice: 300, offerPrice: 270, category: 'Sky Shots (வானவேடிக்கை)', image: 'https://placehold.co/100x100/8b5cf6/ffffff?text=Shot', priceHistory: [270] },
            { id: 11, name: '12 Shot Sky Fire', tamilName: '12 ஷாட் வானவேடிக்கை', originalPrice: 450, offerPrice: 400, category: 'Sky Shots (வானவேடிக்கை)', image: 'https://placehold.co/100x100/8b5cf6/ffffff?text=Shot', priceHistory: [400] },
            { id: 12, name: 'Bijili Crackers', tamilName: 'பிஜிலி வெடி', originalPrice: 40, offerPrice: 35, category: 'Crackers (வெடி)', image: 'https://placehold.co/100x100/f97316/ffffff?text=Cracker', priceHistory: [35] },
            { id: 13, name: 'Kuruvi VEDI', tamilName: 'குருவி வெடி', originalPrice: 30, offerPrice: 25, category: 'Crackers (வெடி)', image: 'https://placehold.co/100x100/f97316/ffffff?text=Cracker', priceHistory: [25] },
            { id: 14, name: 'Rocket Bomb', tamilName: 'ராக்கெட் பாம்', originalPrice: 180, offerPrice: 160, category: 'Rockets (ராக்கெட்)', image: 'https://placehold.co/100x100/14b8a6/ffffff?text=Rocket', priceHistory: [160] },
            { id: 15, name: '2 Sound Rocket', tamilName: '2 சவுண்ட் ராக்கெட்', originalPrice: 220, offerPrice: 200, category: 'Rockets (ராக்கெட்)', image: 'https://placehold.co/100x100/14b8a6/ffffff?text=Rocket', priceHistory: [200] },
            { id: 16, name: 'Whistling Rocket', tamilName: 'விசில் ராக்கெட்', originalPrice: 150, offerPrice: 130, category: 'Rockets (ராக்கெட்)', image: 'https://placehold.co/100x100/14b8a6/ffffff?text=Rocket', priceHistory: [130] },
            { id: 17, name: 'Color Changing Butterfly', tamilName: 'வண்ணத்துப்பூச்சி', originalPrice: 90, offerPrice: 80, category: 'Fancy Items', image: 'https://placehold.co/100x100/d946ef/ffffff?text=Fancy', priceHistory: [80] },
            { id: 18, name: 'Magic Stick', tamilName: 'மேஜிக் ஸ்டிக்', originalPrice: 50, offerPrice: 40, category: 'Fancy Items', image: 'https://placehold.co/100x100/d946ef/ffffff?text=Fancy', priceHistory: [40] },
            { id: 19, name: 'Hydro Bomb', tamilName: 'ஹைட்ரோ பாம்', originalPrice: 250, offerPrice: 225, category: 'Crackers (வெடி)', image: 'https://placehold.co/100x100/f97316/ffffff?text=Cracker', priceHistory: [225] },
            { id: 20, name: '24 Deluxe Shot', tamilName: '24 டீலக்ஸ் ஷாட்', originalPrice: 700, offerPrice: 630, category: 'Sky Shots (வானவேடிக்கை)', image: 'https://placehold.co/100x100/8b5cf6/ffffff?text=Shot', priceHistory: [630] },
            { id: 21, name: 'Color Flower Pots', tamilName: 'கலர் பூந்தொட்டி', originalPrice: 150, offerPrice: 130, category: 'Flower Pots (பூந்தொட்டி)', image: 'https://placehold.co/100x100/22c55e/ffffff?text=Pot', priceHistory: [130] },
            { id: 22, name: 'Electric Sparklers', tamilName: 'எலக்ட்ரிக் மத்தாப்பு', originalPrice: 100, offerPrice: 90, category: 'Sparklers (மத்தாப்பு)', image: 'https://placehold.co/100x100/facc15/333333?text=Sparkler', priceHistory: [90] },
            { id: 23, name: '1000 Wala Garland', tamilName: '1000 வாலா சரம்', originalPrice: 500, offerPrice: 450, category: 'Garlands (சரங்கள்)', image: 'https://placehold.co/100x100/ef4444/ffffff?text=Garland', priceHistory: [450] },
            { id: 24, name: 'Mega Chakkar', tamilName: 'மெகா சக்கரம்', originalPrice: 150, offerPrice: 135, category: 'Chakkars (சக்கரம்)', image: 'https://placehold.co/100x100/3b82f6/ffffff?text=Chakkar', priceHistory: [135] },
            { id: 25, name: 'Atom Bomb', tamilName: 'அணுகுண்டு', originalPrice: 90, offerPrice: 80, category: 'Crackers (வெடி)', image: 'https://placehold.co/100x100/f97316/ffffff?text=Cracker', priceHistory: [80] },
            { id: 26, name: '30 Shot Multi Color', tamilName: '30 ஷாட் மல்டி கலர்', originalPrice: 850, offerPrice: 765, category: 'Sky Shots (வானவேடிக்கை)', image: 'https://placehold.co/100x100/8b5cf6/ffffff?text=Shot', priceHistory: [765] },
            { id: 27, name: 'Parachute Rocket', tamilName: 'பாராசூட் ராக்கெட்', originalPrice: 200, offerPrice: 180, category: 'Rockets (ராக்கெட்)', image: 'https://placehold.co/100x100/14b8a6/ffffff?text=Rocket', priceHistory: [180] },
            { id: 28, name: 'Snake Eggs', tamilName: 'பாம்பு மாத்திரை', originalPrice: 20, offerPrice: 15, category: 'Fancy Items', image: 'https://placehold.co/100x100/d946ef/ffffff?text=Fancy', priceHistory: [15] },
            { id: 29, name: 'Jil Jil', tamilName: 'ஜில் ஜில்', originalPrice: 60, offerPrice: 55, category: 'Fancy Items', image: 'https://placehold.co/100x100/d946ef/ffffff?text=Fancy', priceHistory: [55] },
            { id: 30, name: 'Red Fort', tamilName: 'செங்கோட்டை', originalPrice: 400, offerPrice: 350, category: 'Fancy Items', image: 'https://placehold.co/100x100/d946ef/ffffff?text=Fancy', priceHistory: [350] },
            { id: 31, name: '200 Wala Garland', tamilName: '200 வாலா சரம்', originalPrice: 280, offerPrice: 250, category: 'Garlands (சரங்கள்)', image: 'https://placehold.co/100x100/ef4444/ffffff?text=Garland', priceHistory: [250] },
            { id: 32, name: 'Jumbo Sparklers', tamilName: 'ஜம்போ மத்தாப்பு', originalPrice: 120, offerPrice: 100, category: 'Sparklers (மத்தாப்பு)', image: 'https://placehold.co/100x100/facc15/333333?text=Sparkler', priceHistory: [100] },
            { id: 33, name: 'Crackling Flower Pots', tamilName: 'சிடசிட பூந்தொட்டி', originalPrice: 130, offerPrice: 115, category: 'Flower Pots (பூந்தொட்டி)', image: 'https://placehold.co/100x100/22c55e/ffffff?text=Pot', priceHistory: [115] },
            { id: 34, name: 'Spinner Chakkar', tamilName: 'ஸ்பின்னர் சக்கரம்', originalPrice: 100, offerPrice: 90, category: 'Chakkars (சக்கரம்)', image: 'https://placehold.co/100x100/3b82f6/ffffff?text=Chakkar', priceHistory: [90] },
            { id: 35, 'name': '50 Shot Comet', tamilName: '50 ஷாட் வால்மீன்', originalPrice: 1200, offerPrice: 1080, category: 'Sky Shots (வானவேடிக்கை)', image: 'https://placehold.co/100x100/8b5cf6/ffffff?text=Shot', priceHistory: [1080] },
            { id: 36, 'name': 'Lakshmi VEDI', tamilName: 'லட்சுமி வெடி', originalPrice: 50, offerPrice: 45, category: 'Crackers (வெடி)', image: 'https://placehold.co/100x100/f97316/ffffff?text=Cracker', priceHistory: [45] },
            { id: 37, 'name': '4 Sound Rocket', tamilName: '4 சவுண்ட் ராக்கெட்', originalPrice: 300, offerPrice: 270, category: 'Rockets (ராக்கெட்)', image: 'https://placehold.co/100x100/14b8a6/ffffff?text=Rocket', priceHistory: [270] },
            { id: 38, 'name': 'Photo Flash', tamilName: 'போட்டோ பிளாஷ்', originalPrice: 70, offerPrice: 60, category: 'Fancy Items', image: 'https://placehold.co/100x100/d946ef/ffffff?text=Fancy', priceHistory: [60] },
            { id: 39, 'name': '2000 Wala Garland', tamilName: '2000 வாலா சரம்', originalPrice: 1000, offerPrice: 900, category: 'Garlands (சரங்கள்)', image: 'https://placehold.co/100x100/ef4444/ffffff?text=Garland', priceHistory: [900] },
            { id: 40, 'name': 'Color Smoke Fountain', tamilName: 'கலர் புகை', originalPrice: 150, offerPrice: 135, category: 'Fancy Items', image: 'https://placehold.co/100x100/d946ef/ffffff?text=Fancy', priceHistory: [135] }
        ];

        let products = JSON.parse(localStorage.getItem('crackerProducts')) || initialProducts;
        let newProductImageBase64 = '';

        // --- DOM Elements ---
        const navEnquiry = document.getElementById('nav-enquiry');
        const navAdmin = document.getElementById('nav-admin');
        const enquiryView = document.getElementById('enquiry-view');
        const adminView = document.getElementById('admin-view');
        const productList = document.getElementById('product-list');
        const adminTableBody = document.getElementById('admin-table-body');
        const addProductBtn = document.getElementById('add-product-btn');
        const productModal = document.getElementById('product-modal');
        const modalTitle = document.getElementById('modal-title');
        const productForm = document.getElementById('product-form');
        const cancelBtn = document.getElementById('cancel-btn');
        const imageUploadInput = document.getElementById('product-image-upload');
        const imagePreview = document.getElementById('image-preview');

        // --- Functions ---

        const saveProducts = () => {
            localStorage.setItem('crackerProducts', JSON.stringify(products));
        };

        const renderEnquiryList = () => {
            productList.innerHTML = '';
            if (products.length === 0) {
                productList.innerHTML = `<p class="text-center text-gray-500 col-span-full">No products available.</p>`;
                return;
            }

            const productsByCategory = products.reduce((acc, product) => {
                (acc[product.category] = acc[product.category] || []).push(product);
                return acc;
            }, {});

            Object.keys(productsByCategory).sort().forEach(category => {
                const categoryContainer = document.createElement('div');
                categoryContainer.innerHTML = `<h3 class="text-xl font-bold mb-3 border-b-2 border-red-200 pb-2">${category}</h3>`;
                
                const tableContainer = document.createElement('div');
                tableContainer.className = 'overflow-x-auto bg-white rounded-lg shadow-sm';

                const table = document.createElement('table');
                table.className = 'w-full text-left';
                table.innerHTML = `
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="p-3 font-semibold text-sm w-24">Image</th>
                            <th class="p-3 font-semibold text-sm">English Name</th>
                            <th class="p-3 font-semibold text-sm">Tamil Name</th>
                            <th class="p-3 font-semibold text-sm">Original Price</th>
                            <th class="p-3 font-semibold text-sm">Offer Price</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                `;

                const tbody = table.querySelector('tbody');
                productsByCategory[category].forEach(product => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';

                    let priceIndicator = '';
                    let priceClass = '';
                    if (product.priceHistory && product.priceHistory.length > 1) {
                        const currentPrice = product.priceHistory[product.priceHistory.length - 1];
                        const prevPrice = product.priceHistory[product.priceHistory.length - 2];
                        if (currentPrice > prevPrice) { // Price Increased
                            priceClass = 'price-increased';
                            priceIndicator = `<span class="price-increased ml-2">↑</span>`; 
                        } else if (currentPrice < prevPrice) { // Price Decreased
                            priceClass = 'price-decreased';
                            priceIndicator = `<span class="price-decreased ml-2">↓</span>`;
                        }
                    }

                    row.innerHTML = `
                        <td class="p-3"><img src="${product.image}" alt="${product.name}" class="w-16 h-16 object-cover rounded-md" onerror="this.onerror=null;this.src='https://placehold.co/100x100/cccccc/ffffff?text=NoImg';"></td>
                        <td class="p-3 font-medium">${product.name}</td>
                        <td class="p-3">${product.tamilName}</td>
                        <td class="p-3 text-gray-500 line-through">₹${product.originalPrice}</td>
                        <td class="p-3 font-bold ${priceClass}">₹${product.offerPrice} ${priceIndicator}</td>
                    `;
                    tbody.appendChild(row);
                });

                tableContainer.appendChild(table);
                categoryContainer.appendChild(tableContainer);
                productList.appendChild(categoryContainer);
            });
        };

        const renderAdminTable = () => {
            adminTableBody.innerHTML = '';
            products.forEach(product => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-50';
                row.innerHTML = `
                    <td class="p-2 font-semibold">${product.id}</td>
                    <td class="p-2"><img src="${product.image}" alt="${product.name}" class="w-12 h-12 object-cover rounded-md" onerror="this.onerror=null;this.src='https://placehold.co/100x100/cccccc/ffffff?text=NoImg';"></td>
                    <td class="p-2 font-medium">${product.name}</td>
                    <td class="p-2">${product.tamilName}</td>
                    <td class="p-2">₹${product.originalPrice}</td>
                    <td class="p-2 font-semibold editable-price" data-id="${product.id}">₹${product.offerPrice}</td>
                    <td class="p-2">${product.category}</td>
                    <td class="p-2">
                        <button class="delete-btn text-red-500 hover:text-red-700" data-id="${product.id}">Delete</button>
                    </td>
                `;
                adminTableBody.appendChild(row);
            });
            // Re-attach event listeners for delete buttons
            document.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', handleDelete));
        };
        
        const switchView = (view) => {
            if (view === 'admin') {
                adminView.classList.add('active');
                enquiryView.classList.remove('active');
                navAdmin.classList.add('active', 'text-red-600', 'border-b-2', 'border-red-600');
                navEnquiry.classList.remove('active', 'text-red-600', 'border-b-2', 'border-red-600');
                renderAdminTable();
            } else {
                enquiryView.classList.add('active');
                adminView.classList.remove('active');
                navEnquiry.classList.add('active', 'text-red-600', 'border-b-2', 'border-red-600');
                navAdmin.classList.remove('active', 'text-red-600', 'border-b-2', 'border-red-600');
                renderEnquiryList();
            }
        };

        const showModal = () => {
            productForm.reset();
            modalTitle.textContent = 'Add New Product';
            document.getElementById('product-id').value = '';
            newProductImageBase64 = ''; // Reset image data
            imagePreview.classList.add('hidden');
            imagePreview.src = '';
            productModal.classList.remove('hidden');
        };

        const hideModal = () => {
            productModal.classList.add('hidden');
        };

        const handleFormSubmit = (e) => {
            e.preventDefault();

            if (!newProductImageBase64) {
                alert('Please upload an image.');
                return;
            }

            const newProductData = {
                name: document.getElementById('product-name').value,
                tamilName: document.getElementById('product-tamil-name').value,
                image: newProductImageBase64,
                originalPrice: parseFloat(document.getElementById('product-original-price').value),
                offerPrice: parseFloat(document.getElementById('product-offer-price').value),
                category: document.getElementById('product-category').value,
            };

            const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
            products.push({ 
                id: newId, 
                ...newProductData,
                priceHistory: [newProductData.offerPrice] // Start price history
            });

            saveProducts();
            renderAdminTable();
            renderEnquiryList();
            hideModal();
        };

        const handleDelete = (e) => {
            const id = e.target.dataset.id;
            if (confirm('Indha product-ai neekka venduma?')) {
                products = products.filter(p => p.id != id);
                saveProducts();
                renderAdminTable();
                renderEnquiryList();
            }
        };

        const handlePriceEdit = (e) => {
            if (!e.target.classList.contains('editable-price')) return;

            const cell = e.target;
            const currentText = cell.textContent;
            const currentPrice = parseFloat(currentText.replace('₹', ''));
            const productId = cell.dataset.id;

            cell.innerHTML = ''; // Clear the cell

            const input = document.createElement('input');
            input.type = 'number';
            input.value = currentPrice;
            input.className = 'editable-price-input';

            input.addEventListener('blur', finishEditing);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    input.blur();
                } else if (e.key === 'Escape') {
                    cell.textContent = currentText; // Revert
                }
            });

            cell.appendChild(input);
            input.focus();

            function finishEditing() {
                const newValue = parseFloat(input.value);
                if (!isNaN(newValue) && newValue > 0) {
                     const productIndex = products.findIndex(p => p.id == productId);
                     if (productIndex > -1) {
                        const oldPrice = products[productIndex].offerPrice;
                        if (oldPrice !== newValue) {
                            products[productIndex].offerPrice = newValue;
                            if (!products[productIndex].priceHistory) {
                                products[productIndex].priceHistory = [];
                            }
                            products[productIndex].priceHistory.push(newValue);
                        }
                        saveProducts();
                        cell.textContent = `₹${newValue}`;
                        renderEnquiryList(); // Refresh enquiry view to show indicators
                     } else {
                        cell.textContent = currentText; // Revert on error
                     }
                } else {
                    cell.textContent = currentText; // Revert on invalid input
                }
            }
        };

        const handleImageUpload = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    newProductImageBase64 = event.target.result;
                    imagePreview.src = newProductImageBase64;
                    imagePreview.classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            }
        }


        // --- Event Listeners ---
        navEnquiry.addEventListener('click', () => switchView('enquiry'));
        navAdmin.addEventListener('click', () => switchView('admin'));
        addProductBtn.addEventListener('click', showModal);
        cancelBtn.addEventListener('click', hideModal);
        productForm.addEventListener('submit', handleFormSubmit);
        imageUploadInput.addEventListener('change', handleImageUpload);
        adminTableBody.addEventListener('dblclick', handlePriceEdit);


        // --- Initial Load ---
        switchView('enquiry'); // Start with enquiry view
    });
    </script>

</body>
</html>